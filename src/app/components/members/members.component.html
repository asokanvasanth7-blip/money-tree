<div class="members-container">
  <header class="page-header">
    <div class="header-content">
      <h1>👥 Members & Loans</h1>
      <p class="subtitle">Manage member accounts and loan tracking</p>
    </div>
    <div class="header-actions">
      <button class="btn-export" (click)="exportAllMembers()" title="Export all members to PDF">
        <span class="export-icon">📄</span>
        Export All PDF
      </button>
      <button class="btn-add">
        <span class="plus-icon">+</span>
        Add Member
      </button>
    </div>
  </header>

  <div class="search-container">
    <div class="search-box">
      <span class="search-icon">🔍</span>
      <input
        type="text"
        class="search-input"
        placeholder="Search by name or account number..."
        [(ngModel)]="searchTerm"
      />
      @if (searchTerm) {
        <button class="clear-btn" (click)="searchTerm = ''">✕</button>
      }
    </div>
  </div>

  <div class="members-grid">
    @if (members$ | async; as members) {
      @if (filterMembers(members).length === 0 && searchTerm) {
        <div class="empty-state">
          <div class="empty-icon">🔍</div>
          <h3>No members found</h3>
          <p>Try searching with a different name or account number</p>
          <button class="btn-primary" (click)="searchTerm = ''">Clear Search</button>
        </div>
      } @else if (filterMembers(members).length === 0) {
        <div class="empty-state">
          <div class="empty-icon">📋</div>
          <h3>No members yet</h3>
          <p>Start by adding your first member</p>
          <button class="btn-primary">Add First Member</button>
        </div>
      } @else {
        @for (member of filterMembers(members); track member.accountNumber) {
          <div class="member-card">
            <!-- Card Header with Avatar and Name -->
            <div class="card-header">
              <div class="member-avatar">
                <div class="avatar-circle">
                  {{ getInitials(member.name) }}
                </div>
              </div>
              <div class="member-info-header">
                <h2 class="member-name">{{ member.name }}</h2>
                <span class="verified-badge">
                  <span class="check-icon">✓</span>
                  Active
                </span>
              </div>
            </div>

            <!-- Projects Section -->
            <div class="projects-section">
              <h3 class="section-title">Financial Summary</h3>
              <div class="projects-grid">
                <div class="project-item">
                  <div class="project-icon ongoing">⏱</div>
                  <div class="project-label">Principal</div>
                  <div class="project-count">₹{{ (member.principal / 1000).toFixed(1) }}k</div>
                </div>
                <div class="project-item">
                  <div class="project-icon completed">✓</div>
                  <div class="project-label">Upcoming Due</div>
                  <div class="project-count">₹{{ (member.loanTaken).toFixed(1) }}k</div>
                </div>
              </div>
            </div>

            <!-- Details Grid -->
            <div class="details-grid">
              <div class="detail-row">
                <span class="detail-label">Account</span>
                <span class="detail-value">{{ member.accountNumber.toString().padStart(4, '0') }}</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Loan Taken</span>
                <span class="detail-value loan-value">₹{{ member.loanTaken | number:'1.0-0' }}</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Monthly Due</span>
                <span class="detail-value">₹{{ member.monthlyDue | number:'1.0-0' }}</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Balance</span>
                <span class="detail-value balance-value">₹{{ member.totalBalance | number:'1.0-0' }}</span>
              </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
              <button class="btn-more" title="More options">
                <span class="dots-icon">⋮</span>
              </button>
              <button class="btn-primary-action" (click)="exportSingleMember(member)">
                <span class="message-icon">📄</span>
                Export PDF
              </button>
            </div>
          </div>
        }
      }
    } @else {
      <div class="loading-state">
        <div class="spinner"></div>
        <p>Loading members...</p>
      </div>
    }
  </div>
</div>
